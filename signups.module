<?php
/**
 * @file
 * handle some stuff related to signing up for classes and volunteer
 * assignments
 */

/**
 * implementation of hook_help()
 */
function signups_help ($path, $arg) {
  if ($path == 'admin/help#schedule') {
    $txt = 'This module handles some stuff related to signing '.
           'up for classes and volunteer assignments.';
    return '<p>'. t($txt) .'</p>';
  }
}

/**
 * Implementation of hook_menu()
 */
function signups_menu () {
   // a page for checking existing signups
   $items['admin/signups_check'] = array(
   	 'title' => 'Check Signups',
     'page callback' => '_check_signups',
     'access arguments' => array('administer site configuration'),
     'type' => MENU_CALLBACK,
   );

   return $items;
}

/**
 * start the work of checking that everyone has an assignment
 * every period
 */
function _check_signups () {
  // get the default session for new courses to use as the current session
  module_load_include('inc', 'content', 'includes/content.crud');
  $fields = content_field_instance_read(array('type_name' => 'course',
                                              'field_name' => 'field_course_session'));
  $session_nid = $fields[0]['widget']['default_value'][0]['nid'];

  // get the list of all paid member families
  $result = '<ul>';
  $query = db_query('SELECT nid, title, node.uid, roles.uid, type, rid '.
                    'FROM {node} as node INNER JOIN {users_roles} as roles '.
                    'ON node.uid=roles.uid '.
                    'WHERE type=\'family\' AND rid=8');
  // loop through all paid families
  while ($row = db_fetch_array($query)) {
    // generate the schedule for this family (could probably have made a query to do
    // this all at once, but don't see the point
//    $result .= '  <li>'. $row['nid'] .': '. $row['title'] .'</li>';
  }
  $result .= '</ul>';
  return $result;
}